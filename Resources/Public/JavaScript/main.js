class t extends DOMException{static create(e){return new t(`The element "${e}" does not exist.`)}}var e,o,n;!function(t){t.solution=".solution",t.solutionContainer=".solution-container",t.solutionCurrentResponse=".solution-current-response",t.solutionListItem=".solution-list-item",t.solutionLoaderCount=".solution-loader-count",t.solutionMaxResponses=".solution-max-responses",t.solutionModel=".solution-model",t.solutionPrompt=".solution-prompt > pre",t.solutionSelector=".solution-selector"}(e||(e={})),function(t){t.solutionCaretVisible="solution-caret-visible",t.solutionProvided="solution-provided",t.solutionStreaming="solution-streaming"}(o||(o={})),function(t){t.solutionDelta="solutionDelta",t.solutionError="solutionError",t.solutionFinished="solutionFinished"}(n||(n={}));class s{constructor(t,o,n){this.solution=t,this.exceptionId=o,this.streamHash=n,this.eventSource=null,this.caretInterval=null,this.solutionContainer=this.solution.element.querySelector(e.solutionContainer),this.solutionModel=this.solution.element.querySelector(e.solutionModel),this.solutionMaxResponses=this.solution.element.querySelector(e.solutionMaxResponses),this.solutionPrompt=this.solution.element.querySelector(e.solutionPrompt),this.solutionLoaderCount=this.solution.element.querySelector(e.solutionLoaderCount)}start(){if(null!==this.eventSource&&!this.eventSource.CLOSED)return;const t=new URL(window.location.href);t.pathname="/tx_solver/solution",t.searchParams.set("exception",this.exceptionId),t.searchParams.set("hash",this.streamHash),this.eventSource=new EventSource(t.toString()),this.solution.element.classList.add(o.solutionStreaming),this.caretInterval=setInterval(this.toggleCaret.bind(this),750),this.eventSource.addEventListener(n.solutionDelta,this.handleSolutionDelta.bind(this)),this.eventSource.addEventListener(n.solutionError,this.handleSolutionError.bind(this)),this.eventSource.addEventListener(n.solutionFinished,this.handleSolutionFinished.bind(this))}handleSolutionDelta(t){const e=JSON.parse(t.data),{model:o,numberOfResponses:n,numberOfPendingResponses:s,prompt:i}=e.data;this.solutionContainer.innerHTML=e.content,this.solutionModel.innerHTML=o,this.solutionMaxResponses.innerHTML=n.toString(),this.solutionPrompt.innerHTML=i,s>1&&(this.solutionLoaderCount.innerHTML=s.toString())}handleSolutionError(t){const e=JSON.parse(t.data);this.solution.element.outerHTML=e.content}handleSolutionFinished(){this.solution.element.classList.remove(o.solutionStreaming),this.solution.element.classList.remove(o.solutionCaretVisible),this.solution.element.classList.add(o.solutionProvided),null!==this.caretInterval&&clearInterval(this.caretInterval),this.eventSource?.close(),this.eventSource=null,this.solution.handleSolutionSelection()}toggleCaret(){this.solution.element.classList.contains(o.solutionCaretVisible)?this.solution.element.classList.remove(o.solutionCaretVisible):this.solution.element.classList.add(o.solutionCaretVisible)}}class i{constructor(t){this.element=t}static create(){const o=document.querySelector(e.solution);if(!(o instanceof HTMLElement))throw t.create(e.solution);return new i(o)}canBeStreamed(){return"exceptionId"in this.element.dataset&&"streamHash"in this.element.dataset&&!this.element.classList.contains(o.solutionProvided)}createStream(){if(!this.canBeStreamed())return null;const t=this.element.dataset.exceptionId,e=this.element.dataset.streamHash;return new s(this,t,e)}handleSolutionSelection(){const t=this.element.querySelectorAll(e.solutionListItem),o=this.element.querySelector(e.solutionCurrentResponse);t.forEach((n=>{const s=parseInt(n.dataset.solutionResponseIndex),i=n.querySelector(e.solutionSelector);i?.addEventListener("input",(()=>{null!==o&&(o.innerHTML=(s+1).toString(),n.setAttribute("aria-hidden","false"),t.forEach((t=>{t!==n&&t.setAttribute("aria-hidden","true")})))}))}))}}try{const t=i.create();t.canBeStreamed()?t.createStream().start():t.handleSolutionSelection()}catch(t){}
